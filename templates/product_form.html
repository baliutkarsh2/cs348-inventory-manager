{% extends 'base.html' %}
{% block content %}
<h2 class="mb-3">{{ 'New Product' if action == 'create' else 'Edit Product' }}</h2>
<form action="{{ url_for('products_create') if action=='create' else url_for('products_update', product_id=product.id) }}" method="post" class="mt-3">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Name</label>
      <input type="text" name="name" maxlength="200" class="form-control" value="{{ product.name if product else '' }}" required />
    </div>
    <div class="col-md-6">
      <label class="form-label">SKU</label>
      <input type="text" name="sku" maxlength="50" class="form-control" value="{{ product.sku if product else '' }}" required />
    </div>
    <div class="col-md-4">
      <label class="form-label">Category</label>
      <select class="form-select" name="category_id" required>
        {% for c in categories %}
        <option value="{{ c.id }}" {% if product and product.category_id==c.id %}selected{% endif %}>{{ c.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">Supplier</label>
      <select class="form-select" name="supplier_id" required>
        {% for s in suppliers %}
        <option value="{{ s.id }}" {% if product and product.supplier_id==s.id %}selected{% endif %}>{{ s.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">Location</label>
      <select class="form-select" name="location_id" required>
        {% for l in locations %}
        <option value="{{ l.id }}" {% if product and product.location_id==l.id %}selected{% endif %}>{{ l.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">Price</label>
      <div class="input-group">
        <span class="input-group-text">$</span>
        <input type="number" step="0.01" min="0" name="price" class="form-control" value="{{ '%.2f'|format(product.price) if product else '0.00' }}" required />
      </div>
    </div>
    <div class="col-md-4">
      <label class="form-label">Units in Stock</label>
      <input type="number" min="0" step="1" name="units_in_stock" class="form-control" value="{{ product.units_in_stock if product else 0 }}" required />
    </div>
    <div class="col-md-4">
      <label class="form-label">Reorder Level</label>
      <input type="number" min="0" step="1" name="reorder_level" class="form-control" value="{{ product.reorder_level if product else 0 }}" required />
    </div>
    <div class="col-md-4">
      <label class="form-label">Created At</label>
      <input type="date" name="created_at" class="form-control" value="{{ product.created_at.strftime('%Y-%m-%d') if product else '' }}" />
    </div>
  </div>
  <div class="mt-4">
    <a class="btn btn-secondary" href="{{ url_for('products_list') }}">Cancel</a>
    <button class="btn btn-primary" type="submit">{{ 'Create' if action=='create' else 'Save Changes' }}</button>
  </div>
</form>
{% endblock %}
